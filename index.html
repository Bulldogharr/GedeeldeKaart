<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="utf-8" />
  <title>Mijn Kaart</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin=""/>
</head>

<body>

  <h1>Kaart van de Gemeente Ede</h1>
  
  <!-- Invoervelden -->
  <label for="streetName">Voer straatnaam in:</label>
  <input type="text" id="streetName" placeholder="Bijv. Mendellaan, Ede">
  
  <label for="popupText">Voer popup tekst in:</label>
  <input type="text" id="popupText" placeholder="Bijv. 'Mijn marker'">
  
  <label for="circleColor">Kies kleur van de cirkel:</label>
  <select id="circleColor">
    <option value="green">Groen</option>
    <option value="orange">Oranje</option>
    <option value="red">Rood</option>
    <option value="blue">Blauw</option>
  </select>

  <label for="circleRadius">Kies radius (in meters):</label>
  <select id="circleRadius">
    <option value="250">250 meter</option>
    <option value="300">300 meter</option>
    <option value="400">400 meter</option>
  </select>

  <button onclick="addCircleFromStreetName()">Plaats Cirkel</button>
  
  <div id="map" style="height: 800px;"></div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
          crossorigin=""></script>

  <script>
    var map = L.map('map').setView([52.046, 5.671], 13);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap-bijdragers'
    }).addTo(map);

    function loadSavedCircles() {
      var savedCircles = JSON.parse(localStorage.getItem('savedCircles')) || [];
      savedCircles.forEach(function(circleData, index) {
        var circle = L.circle([circleData.lat, circleData.lon], {
          color: circleData.color,
          fillColor: circleData.fillColor,
          fillOpacity: 0.5,
          radius: circleData.radius || 250
        }).addTo(map);

        var centerDot = L.circleMarker([circleData.lat, circleData.lon], {
          radius: 6,
          color: 'black',
          fillColor: 'black',
          fillOpacity: 1
        }).addTo(map);

        circle.bindPopup(circleData.popupText);
        centerDot.bindPopup('Middelpunt van de cirkel');

        circle.on('contextmenu', function(e) {
          var action = prompt("Kies een actie:\n1. Naam aanpassen\n2. Verwijderen\n3. Kleur aanpassen\n4. Radius aanpassen\nTyp 1, 2, 3 of 4.");
          if (action == "1") {
            var newPopupText = prompt("Pas de popup-tekst aan:", circleData.popupText);
            if (newPopupText !== null) {
              circleData.popupText = newPopupText;
              circle.bindPopup(newPopupText);
              centerDot.bindPopup('Middelpunt van de cirkel');
              updateCircleInStorage(index, circleData);
            }
          } else if (action == "2") {
            var removeCircle = confirm("Weet je zeker dat je deze cirkel wilt verwijderen?");
            if (removeCircle) {
              map.removeLayer(circle);
              map.removeLayer(centerDot);
              removeCircleFromStorage(index);
            }
          } else if (action == "3") {
            var newColor = prompt("Kies een nieuwe kleur:\n1. Groen\n2. Oranje\n3. Rood\n4. Blauw\nTyp 1, 2, 3 of 4.");
            var newFillColor = getColorFromChoice(newColor);
            if (newFillColor) {
              var colorLabel = newColor == '1' ? 'green' : newColor == '2' ? 'orange' : newColor == '3' ? 'red' : 'blue';
              circleData.color = colorLabel;
              circleData.fillColor = newFillColor;
              circle.setStyle({
                color: colorLabel,
                fillColor: newFillColor
              });
              updateCircleInStorage(index, circleData);
            }
          } else if (action == "4") {
            var newRadius = prompt("Geef een nieuwe radius in meters (bijv. 250, 300, 400):", circleData.radius);
            newRadius = parseInt(newRadius);
            if (!isNaN(newRadius) && newRadius > 0) {
              circleData.radius = newRadius;
              circle.setRadius(newRadius);
              updateCircleInStorage(index, circleData);
            } else {
              alert("Ongeldige radius.");
            }
          }
        });
      });
    }

    loadSavedCircles();

    function addCircleFromStreetName() {
      var streetName = document.getElementById('streetName').value;
      var popupText = document.getElementById('popupText').value;
      var circleColor = document.getElementById('circleColor').value;
      var circleRadius = parseInt(document.getElementById('circleRadius').value);

      if (streetName) {
        var url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(streetName)}`;

        fetch(url)
          .then(response => response.json())
          .then(data => {
            if (data && data.length > 0) {
              var lat = parseFloat(data[0].lat);
              var lon = parseFloat(data[0].lon);

              var fillColor;
              switch(circleColor) {
                case 'green':
                  fillColor = '#00f033';
                  break;
                case 'orange':
                  fillColor = '#FFA500';
                  break;
                case 'red':
                  fillColor = '#FF0000';
                  break;
                case 'blue':
                  fillColor = '#0000FF';
                  break;
                default:
                  fillColor = '#999999';
              }

              var newCircle = L.circle([lat, lon], {
                color: circleColor,
                fillColor: fillColor,
                fillOpacity: 0.5,
                radius: circleRadius
              }).addTo(map);

              var centerDot = L.circleMarker([lat, lon], {
                radius: 6,
                color: 'black',
                fillColor: 'black',
                fillOpacity: 1
              }).addTo(map);

              map.setView([lat, lon], 13);

              newCircle.bindPopup(popupText);
              centerDot.bindPopup('Middelpunt van de cirkel');

              var savedCircles = JSON.parse(localStorage.getItem('savedCircles')) || [];
              savedCircles.push({
                lat: lat,
                lon: lon,
                popupText: popupText,
                color: circleColor,
                fillColor: fillColor,
                radius: circleRadius
              });

              localStorage.setItem('savedCircles', JSON.stringify(savedCircles));
            } else {
              alert("Straat niet gevonden, probeer een andere straatnaam.");
            }
          })
          .catch(error => {
            alert("Er is een fout opgetreden bij het ophalen van de co√∂rdinaten.");
          });
      } else {
        alert("Voer een straatnaam in.");
      }
    }

    function removeCircleFromStorage(index) {
      var savedCircles = JSON.parse(localStorage.getItem('savedCircles')) || [];
      savedCircles.splice(index, 1);
      localStorage.setItem('savedCircles', JSON.stringify(savedCircles));
    }

    function updateCircleInStorage(index, newCircleData) {
      var savedCircles = JSON.parse(localStorage.getItem('savedCircles')) || [];
      savedCircles[index] = newCircleData;
      localStorage.setItem('savedCircles', JSON.stringify(savedCircles));
    }

    function getColorFromChoice(choice) {
      switch(choice) {
        case '1':
          return '#00f033'; // Groen
        case '2':
          return '#FFA500'; // Oranje
        case '3':
          return '#FF0000'; // Rood
        case '4':
          return '#0000FF'; // Blauw
        default:
          return null;
      }
    }
  </script>

</body>
</html>
